"
" The default vim config. Make the vim work like an IDE.
" Author: OctHe
" Copyright (C)
"
" =====================================================================
source $VIMRUNTIME/vimrc_example.vim

" Enable file type detection.
filetype plugin on
" Enable automatic indentation.
filetype indent on

" Keymappings {{{1

" Use <Space> as the <Leader>
" This command must be before all keymappings and plugin configs
let mapleader = ' '

" Easy-nohlsearch
nnoremap <silent> <Esc> :nohlsearch<CR>

" Easy indent
vmap < <gv
vmap > >gv

" Show mappings
nnoremap <silent> <Leader>m :verbose map

" }}}1

" Try to install vim-plug if not found
let s:vim_plug = expand('~/.vim/autoload/plug.vim')
if !filereadable(s:vim_plug)
  execute '!curl -fLo' s:vim_plug
        \ '--create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim'

  if empty(s:vim_plug)
    echo "curl plug.vim from raw.githubusercontent.com failed. Try git clone.\n"

    silent !git clone https://github.com/junegunn/vim-plug /tmp/vim-plug
    execute '!cp /tmp/vim-plug/plug.vim' s:vim_plug
    silent !rm -rf /tmp/vim-plug
  endif

endif

" Specify a directory for plugins
" - Avoid using standard Vim directory names like 'plugin'
let s:plugin_dir = expand('~/.local/share/vim/plugins/')
call plug#begin(s:plugin_dir)

Plug 'tpope/vim-surround'
Plug 'tpope/vim-repeat'
" speeddating: Use <c-a>/<c-x> to increment datas and times
Plug 'tpope/vim-speeddating'
Plug 'tpope/vim-endwise'
" fugitive: Provide common git options (diff, status, add, commit, etc)
Plug 'tpope/vim-fugitive'
autocmd User plugin_config call vcs#Fugitive(s:plugin_dir)

" starsearch: Enhanced star keymapping. Avoid jumping to next
Plug 'vim-scripts/star-search'

" NERDTree: File explorer.
Plug 'preservim/nerdtree'
autocmd User plugin_config call navigator#NerdTree(s:plugin_dir)
Plug 'preservim/tagbar'
Plug 'preservim/nerdcommenter'
autocmd User plugin_config call completor#NerdCommenter(s:plugin_dir)
Plug 'preservim/vim-indent-guides'
autocmd User plugin_config call view#IndentGuides(s:plugin_dir)
Plug 'preservim/vim-pencil'

" Use the latest fzf instead of the system-wide fzf
Plug 'junegunn/fzf', { 'do': { -> fzf#install() } }
Plug 'junegunn/fzf.vim'
" vim-plug: Register vim-plug as a plugin to get the help doc.
Plug 'junegunn/vim-plug'
Plug 'junegunn/vim-easy-align'
" goyo.vim and limelight.vim improves text experience
Plug 'junegunn/goyo.vim'
autocmd User plugin_config call view#Goyo(s:plugin_dir)
Plug 'junegunn/limelight.vim'
autocmd User plugin_config call view#Limelight(s:plugin_dir)
" Display contents in register
Plug 'junegunn/vim-peekaboo'
" Colorscheme
Plug 'junegunn/seoul256.vim'

Plug 'liuchengxu/vim-which-key'
autocmd User plugin_config call view#Whichkey(s:plugin_dir)

Plug 'mhinz/vim-signify'
" Grep the results into a quickfix.
Plug 'mhinz/vim-grepper'
autocmd User plugin_config call navigator#Grepper(s:plugin_dir)
Plug 'mhinz/vim-startify'

Plug 'itchyny/vim-cursorword'
Plug 'itchyny/lightline.vim'

if has('python3')
  " Ultisnips: snippets engine that uses snippet database
  " vim-snippets: snippet database
  Plug 'honza/vim-snippets'
  Plug 'SirVer/ultisnips'
  autocmd User plugin_config call completor#UltiSnips(s:plugin_dir)

  Plug 'puremourning/vimspector'
  autocmd User plugin_config call runner#Vimspector(s:plugin_dir)
endif

if v:versionlong >= 9010016 && has('python3') && executable('cmake')
  " YCM: a powerful completion engine based on LSP. It relies on cmake,
  " make, g++, python3-dev and LSP.
  " Install the prerequisites in Debian with
  "   sudo apt install cmake make g++ python3-dev
  " In openSUSE with
  "   sudo zypper install cmake make g++ python3-deval
  Plug 'ycm-core/YouCompleteMe', {'do': './install.py --clangd-completor'}
  autocmd User plugin_config call completor#YCM(s:plugin_dir)
elseif has('python3')
  Plug 'maralla/completor.vim'
else
  Plug 'ervandew/supertab'
endif

Plug 'voldikss/vim-floaterm'
autocmd User plugin_config call runner#Floaterm(s:plugin_dir)

" vim-tmux-navigator
" It requires configuration in tmux
if isdirectory(glob('~/.local/share/tmux/plugin/vim-tmux-navigator'))
  " Use the same file for both vim and tmux
  Plug '~/.local/share/tmux/plugin/vim-tmux-navigator'
else
  Plug 'christoomey/vim-tmux-navigator'
endif

" Sneak: Jump with 2 chars.
Plug 'justinmk/vim-sneak'
autocmd User plugin_config call navigator#Sneak(s:plugin_dir)
" Path navigator
Plug 'justinmk/vim-dirvish'


" rainbow: Rainbow brackets
Plug 'luochen1990/rainbow'
autocmd User plugin_config call view#Rainbow(s:plugin_dir)

Plug 'unblevable/quick-scope'

Plug 'mbbill/undotree'
autocmd User plugin_config call navigator#Undotree(s:plugin_dir)

" Auto close parentheses and repeat by dot dot dot...
Plug 'cohama/lexima.vim'

Plug 'dense-analysis/ale'
autocmd User plugin_config call lint#ALE(s:plugin_dir)

Plug 'skywind3000/asyncrun.vim'

Plug 'mg979/vim-visual-multi'

Plug 'AndrewRadev/splitjoin.vim'

Plug 'ntpeters/vim-better-whitespace'

Plug 'wellle/context.vim'

Plug 'psliwka/vim-smoothie'

Plug 'lervag/vimtex'
autocmd User plugin_config call runner#vimtex(s:plugin_dir)

" vim-signature: Manage marks with column
Plug 'kshenoy/vim-signature'

" Initialize plugin system
call plug#end()
doautocmd User plugin_config

" View {{{1
try
  " Plugin colorscheme
  colorscheme seoul256
catch
  " Builtin colorscheme
  colorscheme desert
endtry
" }}}1

" Options {{{1
set hlsearch                   " Highlight the search results
set incsearch                  " Show the pattern while typing

set smartindent                " Do smart autoindenting
set expandtab                  " Expand tag to space
set tabstop=4                  " One tab includes four spaces
set shiftwidth=4               " The width of '<' and '>'
set backspace=indent,eol,start " Allow backspacing over everything in insert mode.

set splitbelow                 " New buffer splits below by default
set splitright                 " New buffer splits right by default

set modeline                   " Modeline is the last comment line if vim is the editor. See `help modeline`
set hidden                     " Hide unsaved buffer
set ruler                      " show the cursor position
set wildmenu                   " display completion matches in a status line
set number                     " Show line number
set mouse=a                    " Enable mouse in all mode
set fileencodings=utf-8,gb18030,latin1

set colorcolumn=81

syntax enable                  " Enable syntax-related features. Without this, some VimTeX features may not work
" }}}1

" Commands {{{1
augroup EnhancedHelp
  au!

  autocmd BufWinEnter *
        \ if &filetype == 'help'
        \ |   set number
        \ |   if winwidth('%') > 180
        \ |       wincmd L
        \ |       vertical resize 90
        \ |   endif
        \ | endif

augroup END
"}}}

" vim: set sw=2 sts=2 et:
